"use strict"; window.EGS={VERSION:'1.0'};EGS.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);EGS.clone=function(myObj){if(!myObj)return myObj;else if(myObj instanceof Array)return myObj.slice(0);else if(!(myObj instanceof Object))return myObj;var myNewObj={};for(var i in myObj){try{myNewObj[i]=EGS.clone(myObj[i]);}catch(e){}};return myNewObj;};EGS.extend=function(dst,src){for(var i in src){try{dst[i]=src[i];}catch(e){}};return dst;};EGS.ClassInitWithArr={};EGS.Class=function(){var c=function(bInitWithArr,argArray){if(this.initialize&&this.initialize.apply){if(bInitWithArr===EGS.ClassInitWithArr)this.initialize.apply(this,argArray);else  this.initialize.apply(this,arguments);}};c.ancestors=EGS.clone(arguments);c.prototype={};for(var i=0;i<arguments.length;i++){var a=arguments[i]if(a.prototype){EGS.extend(c.prototype,a.prototype);}else{EGS.extend(c.prototype,a);}};EGS.extend(c,c.prototype);return c;};EGS.release=function(myObj){if(!(myObj instanceof Object))return;for(var i in myObj){try{delete myObj[i];};catch(ex){alert(ex.toString());}}};EGS.deepRelease=function(myObj){if(!(myObj instanceof Object))return;if(myObj instanceof Array){for(var i in myObj){EGS.release(myObj[i]);}};for(var i in myObj){try{EGS.release(myObj[i]);delete myObj[i];};catch(ex){alert(ex.toString());}}};EGS.loadShaderSourceFromScript=function(scriptID){var shaderScript=document.getElementById(scriptID);if(shaderScript==null)return"";var sourceCode="";var child=shaderScript.firstChild;while(child){if(child.nodeType==child.TEXT_NODE)sourceCode+=child.textContent;child=child.nextSibling;};return sourceCode;};EGS.requestTextByURL=function(url,callback){var async=callback?true:false;var xmlHttp=new XMLHttpRequest();xmlHttp.open('get',url,async);if(async){xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){callback(xmlHttp.responseText,xmlHttp);}};};xmlHttp.send();return xmlHttp.responseText;};EGS.webglCanvas=function(canvasId){var myCanvasObject=document.getElementById(canvasId);var context=null;try{context=myCanvasObject.getContext("experimental-webgl");}catch(ex){ex.toString();};if(!context){alert("我靠， 你的浏览器不支持WebGL,换个浏览器吧");return null;};context.viewport(0,0,myCanvasObject.width,myCanvasObject.height);return context;}; EGS.InitShader=EGS.Class({webgl:null,initialize:function(cxt){this.webgl=cxt;},initCanvas:function(myCanvasObject){var context=null;try{context=myCanvasObject.getContext("experimental-webgl");}catch(ex){ex.toString();};if(!context){alert("我靠， 你的浏览器不支持WebGL,换个浏览器吧");return null;};context.viewport(0,0,myCanvasObject.width,myCanvasObject.height);return context;},requestUrlText:function(url){var xmlHttp=new XMLHttpRequest();xmlHttp.open("GET","../../Shaders/"+url+"?t="+Math.random(),false);xmlHttp.send();return xmlHttp.responseText;},loadFragmentShaderFromFile:function(scriptId){var shaderScript=document.createElement("script");shaderScript.type="x-shader/x-fragment";shaderScript.id=scriptId;shaderScript.innerHTML=this.requestUrlText(scriptId+".fsh");var head=document.getElementsByTagName("body").item(0);head.appendChild(shaderScript);},shaderSourceFromScript:function(scriptID){var shaderScript=document.getElementById(scriptID);if(shaderScript==null)return"";var sourceCode="";var child=shaderScript.firstChild;while(child){if(child.nodeType==child.TEXT_NODE)sourceCode+=child.textContent;child=child.nextSibling;};return sourceCode;},compileShader:function(webgl,shaderVectexCode,shaderFramentCode,vertexShaderObj,fragmentShaderObj){webgl.shaderSource(vertexShaderObj,shaderVectexCode);webgl.shaderSource(fragmentShaderObj,shaderFramentCode);webgl.compileShader(vertexShaderObj);webgl.compileShader(fragmentShaderObj);if(!webgl.getShaderParameter(vertexShaderObj,webgl.COMPILE_STATUS)){alert("error:vertexShaderObject");return;};if(!webgl.getShaderParameter(fragmentShaderObj,webgl.COMPILE_STATUS)){alert("error:framentShaderObject");return;}},linkShader:function(webgl,programObj,vertexShaderObj,fragmentShaderObj){webgl.attachShader(programObj,vertexShaderObj);webgl.attachShader(programObj,fragmentShaderObj);webgl.linkProgram(programObj);if(!webgl.getProgramParameter(programObj,webgl.LINK_STATUS)){alert("error:ProgramObject");return;};return programObj;},initShaders:function(webgl,vertexShaderId,framentShaderId,bindVariableData){var vertexShaderObject=webgl.createShader(webgl.VERTEX_SHADER);var fragmentShaderObject=webgl.createShader(webgl.FRAGMENT_SHADER);var vertextShaderCode=this.shaderSourceFromScript(vertexShaderId);var fragmentShaderCode=this.shaderSourceFromScript(framentShaderId);if(fragmentShaderCode==""){this.loadFragmentShaderFromFile(framentShaderId);fragmentShaderCode=this.shaderSourceFromScript(framentShaderId);};this.compileShader(webgl,vertextShaderCode,fragmentShaderCode,vertexShaderObject,fragmentShaderObject);programObject=webgl.createProgram();if(!bindVariableData instanceof Array){alert("输入参数有错");return;};for(var i=0;i<bindVariableData.length;i++){webgl.bindAttribLocation(programObject,bindVariableData[i][0],bindVariableData[i][1]);};programObject=this.linkShader(webgl,programObject,vertexShaderObject,fragmentShaderObject);return programObject;},initShaderWidthString:function(webgl,vertextShaderCode,fragmentShaderCode,bindVariableData){var vertexShaderObject=webgl.createShader(webgl.VERTEX_SHADER);var fragmentShaderObject=webgl.createShader(webgl.FRAGMENT_SHADER);if(fragmentShaderCode==""){this.loadFragmentShaderFromFile(framentShaderId);fragmentShaderCode=this.shaderSourceFromScript(framentShaderId);};this.compileShader(webgl,vertextShaderCode,fragmentShaderCode,vertexShaderObject,fragmentShaderObject);programObject=webgl.createProgram();if(!bindVariableData instanceof Array){alert("输入参数有错");return;};for(var i=0;i<bindVariableData.length;i++){webgl.bindAttribLocation(programObject,bindVariableData[i][0],bindVariableData[i][1]);};programObject=this.linkShader(webgl,programObject,vertexShaderObject,fragmentShaderObject);return programObject;}}); var swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=false,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,isDomLoaded=false,isExpressInstallActive=false,dynamicStylesheet,dynamicStylesheetMedia,autoHideShow=true, ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=!+"\v1",playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){plugin=true;ie=false;d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}else if(typeof win.ActiveXObject!=UNDEF){try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(a){d=a.GetVariable("$version");if(d){ie=true;d=d.split(" ")[1].split(",");playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}}};catch(e){}};return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac};}(), onDomLoad=function(){if(!ua.w3){return;};if((typeof doc.readyState!=UNDEF&&doc.readyState=="complete")||(typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))){callDomLoadFunctions();};if(!isDomLoaded){if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,false);};if(ua.ie&&ua.win){doc.attachEvent(ON_READY_STATE_CHANGE,function(){if(doc.readyState=="complete"){doc.detachEvent(ON_READY_STATE_CHANGE,arguments.callee);callDomLoadFunctions();}});if(win==top){(function(){if(isDomLoaded){return;};try{doc.documentElement.doScroll("left");};catch(e){setTimeout(arguments.callee,0);return;};callDomLoadFunctions();})();}};if(ua.wk){(function(){if(isDomLoaded){return;};if(!/loaded|complete/.test(doc.readyState)){setTimeout(arguments.callee,0);return;};callDomLoadFunctions();})();};addLoadEvent(callDomLoadFunctions);}}();function callDomLoadFunctions(){if(isDomLoaded){return;};try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t);};catch(e){return;};isDomLoaded=true;var dl=domLoadFnArr.length;for(var i=0;i<dl;i++){domLoadFnArr[i]();}};function addDomLoadEvent(fn){if(isDomLoaded){fn();}else{domLoadFnArr[domLoadFnArr.length]=fn;}} ;function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF){win.addEventListener("load",fn,false);}else if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("load",fn,false);}else if(typeof win.attachEvent!=UNDEF){addListener(win,"onload",fn);}else if(typeof win.onload=="function"){var fnOld=win.onload;win.onload=function(){fnOld();fn();};}else{win.onload=fn;}} ;function main(){if(plugin){testPlayerVersion();}else{matchVersions();}} ;function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0];var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;(function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}}else if(counter<10){counter++;setTimeout(arguments.callee,10);return;};b.removeChild(o);t=null;matchVersions();})();}else{matchVersions();}} ;function matchVersions(){var rl=regObjArr.length;if(rl>0){for(var i=0;i<rl;i++){var id=regObjArr[i].id;var cb=regObjArr[i].callbackFn;var cbObj={success:false,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj){if(hasPlayerVersion(regObjArr[i].swfVersion)&&!(ua.wk&&ua.wk<312)){setVisibility(id,true);if(cb){cbObj.success=true;cbObj.ref=getObjectById(id);cb(cbObj);}}else if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall;att.width=obj.getAttribute("width")||"0";att.height=obj.getAttribute("height")||"0";if(obj.getAttribute("class")){att.styleclass=obj.getAttribute("class");};if(obj.getAttribute("align")){att.align=obj.getAttribute("align");};var par={};var p=obj.getElementsByTagName("param");var pl=p.length;for(var j=0;j<pl;j++){if(p[j].getAttribute("name").toLowerCase()!="movie"){par[p[j].getAttribute("name")]=p[j].getAttribute("value");}};showExpressInstall(att,par,id,cb);}else{displayAltContent(obj);if(cb){cb(cbObj);}}}}else{setVisibility(id,true);if(cb){var o=getObjectById(id);if(o&&typeof o.SetVariable!=UNDEF){cbObj.success=true;cbObj.ref=o;};cb(cbObj);}}}}};function getObjectById(objectIdStr){var r=null;var o=getElementById(objectIdStr);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!=UNDEF){r=o;}else{var n=o.getElementsByTagName(OBJECT)[0];if(n){r=n;}}};return r;} ;function canExpressInstall(){return!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312);} ;function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=true;storedCallbackFn=callbackFn||null;storedCallbackObj={success:false,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){if(obj.nodeName=="OBJECT"){storedAltContent=abstractAltContent(obj);storedAltContentId=null;}else{storedAltContent=obj;storedAltContentId=replaceElemIdStr;};att.id=EXPRESS_INSTALL_ID;if(typeof att.width==UNDEF||(!/%$/.test(att.width)&&parseInt(att.width,10)<310)){att.width="310";};if(typeof att.height==UNDEF||(!/%$/.test(att.height)&&parseInt(att.height,10)<137)){att.height="137";};doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+encodeURI(window.location).toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+fv;}else{par.flashvars=fv;};if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew";newObj.setAttribute("id",replaceElemIdStr);obj.parentNode.insertBefore(newObj,obj);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj);}else{setTimeout(arguments.callee,10);}})();};createSWF(att,par,replaceElemIdStr);}} ;function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");obj.parentNode.insertBefore(el,obj);el.parentNode.replaceChild(abstractAltContent(obj),el);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj);}else{setTimeout(arguments.callee,10);}})();}else{obj.parentNode.replaceChild(abstractAltContent(obj),obj);}};function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie){ac.innerHTML=obj.innerHTML;}else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c){var cl=c.length;for(var i=0;i<cl;i++){if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8)){ac.appendChild(c[i].cloneNode(true));}}}}};return ac;} ;function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312){return r;};if(el){if(typeof attObj.id==UNDEF){attObj.id=id;};if(ua.ie&&ua.win){var att="";for(var i in attObj){if(attObj[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){parObj.movie=attObj[i];}else if(i.toLowerCase()=="styleclass"){att+=' class="'+attObj[i]+'"';}else if(i.toLowerCase()!="classid"){att+=' '+i+'="'+attObj[i]+'"';}}};var par="";for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par+='<param name="'+j+'" value="'+parObj[j]+'" />';}};el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+'>'+par+'</object>';objIdArr[objIdArr.length]=attObj.id;r=getElementById(attObj.id);}else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj){if(attObj[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){o.setAttribute("class",attObj[m]);}else if(m.toLowerCase()!="classid"){o.setAttribute(m,attObj[m]);}}};for(var n in parObj){if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){createObjParam(o,n,parObj[n]);}};el.parentNode.replaceChild(o,el);r=o;}};return r;};function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName);p.setAttribute("value",pValue);el.appendChild(p);} ;function removeSWF(id){var obj=getElementById(id);if(obj&&obj.nodeName=="OBJECT"){if(ua.ie&&ua.win){obj.style.display="none";(function(){if(obj.readyState==4){removeObjectInIE(id);}else{setTimeout(arguments.callee,10);}})();}else{obj.parentNode.removeChild(obj);}}};function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null;}};obj.parentNode.removeChild(obj);}} ;function getElementById(id){var el=null;try{el=doc.getElementById(id);};catch(e){};return el;};function createElement(el){return doc.createElement(el);} ;function addListener(target,eventType,fn){target.attachEvent(eventType,fn);listenersArr[listenersArr.length]=[target,eventType,fn];} ;function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");v[0]=parseInt(v[0],10);v[1]=parseInt(v[1],10)||0;v[2]=parseInt(v[2],10)||0;return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false;} ;function createCSS(sel,decl,media,newStyle){if(ua.ie&&ua.mac){return;};var h=doc.getElementsByTagName("head")[0];if(!h){return;};var m=(media&&typeof media=="string")?media:"screen";if(newStyle){dynamicStylesheet=null;dynamicStylesheetMedia=null;};if(!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css");s.setAttribute("media",m);dynamicStylesheet=h.appendChild(s);if(ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0){dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1];};dynamicStylesheetMedia=m;};if(ua.ie&&ua.win){if(dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT){dynamicStylesheet.addRule(sel,decl);}}else{if(dynamicStylesheet&&typeof doc.createTextNode!=UNDEF){dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"));}}};function setVisibility(id,isVisible){if(!autoHideShow){return;};var v=isVisible?"visible":"hidden";if(isDomLoaded&&getElementById(id)){getElementById(id).style.visibility=v;}else{createCSS("#"+id,"visibility:"+v);}} ;function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;var hasBadChars=regex.exec(s)!=null;return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s;} ;var cleanup=function(){if(ua.ie&&ua.win){window.attachEvent("onunload",function(){var ll=listenersArr.length;for(var i=0;i<ll;i++){listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2]);};var il=objIdArr.length;for(var j=0;j<il;j++){removeSWF(objIdArr[j]);};for(var k in ua){ua[k]=null;};ua=null;for(var l in swfobject){swfobject[l]=null;};swfobject=null;});}}();return{ registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr;regObj.swfVersion=swfVersionStr;regObj.expressInstall=xiSwfUrlStr;regObj.callbackFn=callbackFn;regObjArr[regObjArr.length]=regObj;setVisibility(objectIdStr,false);}else if(callbackFn){callbackFn({success:false,id:objectIdStr});}},getObjectById:function(objectIdStr){if(ua.w3){return getObjectById(objectIdStr);}},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:false,id:replaceElemIdStr};if(ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr){setVisibility(replaceElemIdStr,false);addDomLoadEvent(function(){widthStr+="";heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT){for(var i in attObj){att[i]=attObj[i];}};att.data=swfUrlStr;att.width=widthStr;att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT){for(var j in parObj){par[j]=parObj[j];}};if(flashvarsObj&&typeof flashvarsObj===OBJECT){for(var k in flashvarsObj){if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+k+"="+flashvarsObj[k];}else{par.flashvars=k+"="+flashvarsObj[k];}}};if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);if(att.id==replaceElemIdStr){setVisibility(replaceElemIdStr,true);};callbackObj.success=true;callbackObj.ref=obj;}else if(xiSwfUrlStr&&canExpressInstall()){att.data=xiSwfUrlStr;showExpressInstall(att,par,replaceElemIdStr,callbackFn);return;}else{setVisibility(replaceElemIdStr,true);};if(callbackFn){callbackFn(callbackObj);}});}else if(callbackFn){callbackFn(callbackObj);}},switchOffAutoHideShow:function(){autoHideShow=false;},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]};},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3){return createSWF(attObj,parObj,replaceElemIdStr);}else{return undefined;}},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){if(ua.w3&&canExpressInstall()){showExpressInstall(att,par,replaceElemIdStr,callbackFn);}},removeSWF:function(objElemIdStr){if(ua.w3){removeSWF(objElemIdStr);}},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){if(ua.w3){createCSS(selStr,declStr,mediaStr,newStyleBoolean);}},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)){q=q.split("?")[1];};if(param==null){return urlEncodeIfNecessary(q);};var pairs=q.split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=")+1)));}}};return"";},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);if(obj&&storedAltContent){obj.parentNode.replaceChild(storedAltContent,obj);if(storedAltContentId){setVisibility(storedAltContentId,true);if(ua.ie&&ua.win){storedAltContent.style.display="block";}};if(storedCallbackFn){storedCallbackFn(storedCallbackObj);}};isExpressInstallActive=false;}}};}();"use strict";var v3PositionIndex=0;var sampleTexIndex=-1;var triangleBuffer=null;var triangleBuffer=null;var textObj=null;var sampleTexObj1=null;var sampleTexObj2=null;var sampleTexObj3=null;var sampIndex1=0;var sampIndex2=1;var sampIndex3=2;var imgTag=null;var webglCanvas=null;var s=null;var time=0;var d=null;var img=null;function initData(webgl){var jsArrayData=[1.0,1.0,1.0,1.0,-1.0,1.0,-1.0,-1.0,1.0,-1.0,-1.0,1.0,-1.0,1.0,1.0,1.0,1.0,1.0,]triangleBuffer=webgl.createBuffer();webgl.bindBuffer(webgl.ARRAY_BUFFER,triangleBuffer);webgl.bufferData(webgl.ARRAY_BUFFER,new Float32Array(jsArrayData),webgl.STATIC_DRAW);textObj=webgl.createTexture();webgl.bindTexture(webgl.TEXTURE_2D,textObj);webgl.texImage2D(webgl.TEXTURE_2D,0,webgl.RGB,webgl.RGB,webgl.UNSIGNED_BYTE,img);webgl.texParameteri(webgl.TEXTURE_2D,webgl.TEXTURE_MIN_FILTER,webgl.NEAREST);webgl.texParameteri(webgl.TEXTURE_2D,webgl.TEXTURE_MAG_FILTER,webgl.NEAREST);webgl.texParameteri(webgl.TEXTURE_2D,webgl.TEXTURE_WRAP_S,webgl.CLAMP_TO_EDGE);webgl.texParameteri(webgl.TEXTURE_2D,webgl.TEXTURE_WRAP_T,webgl.CLAMP_TO_EDGE);};function renderScene(webgl){webgl.clearColor(0.0,0.0,0.0,1.0);webgl.clear(webgl.COLOR_BUFFER_BIT);webgl.bindBuffer(webgl.ARRAY_BUFFER,triangleBuffer);webgl.enableVertexAttribArray(v3PositionIndex);webgl.vertexAttribPointer(v3PositionIndex,3,webgl.FLOAT,false,0,0);webgl.activeTexture(webgl.TEXTURE0);webgl.bindTexture(webgl.TEXTURE_2D,textObj);webgl.uniform1i(sampleTexIndex,0);webgl.drawArrays(webgl.TRIANGLES,0,6);webgl.deleteTexture(textObj);webgl.deleteBuffer(triangleBuffer);d=new Date();time=d.getTime();s=webglCanvas.toDataURL("image/jpeg",1);d=new Date();var ds=d.getTime()-time;console.log("toDataURL:"+ds);time=d.getTime();document.getElementById("HaoZhaoPian").test3(s);s=null;};function init(){var vertexShader="attribute vec3 v3Position;varying vec2 vTexCood;void main(){vTexCood = vec2((v3Position.x+1.0)/2.0, 1.0-(v3Position.y+1.0)/2.0);gl_Position = vec4(v3Position, 1.0);}";;var fragmentShader="precision mediump float;varying vec2 vTexCood;uniform sampler2D sTexture;      void main(){vec3 src = texture2D(sTexture, vTexCood).rgb;vec3 dst;dst.r = 0.3*src.r + 0.59*src.g + 0.11*src.b;dst.g = 0.3*src.r + 0.59*src.g + 0.11*src.b;dst.b = 0.3*src.r + 0.59*src.g + 0.11*src.b;gl_FragColor = vec4(dst, 1.0);}";if(webglCanvas==null)webglCanvas=document.createElement("canvas");webglCanvas.width=img.width;webglCanvas.height=img.height;console.log("width:"+img.width+"height:"+img.height);var initShader=new EGS.InitShader();var canvas=initShader.initCanvas(webglCanvas);var bind1=[v3PositionIndex,"v3Position"];var bindData=new Array();bindData.push(bind1);var shaderProgramObject=initShader.initShaderWidthString(canvas,vertexShader,fragmentShader,bindData);sampleTexIndex=canvas.getUniformLocation(shaderProgramObject,"sTexture");canvas.useProgram(shaderProgramObject);initData(canvas);renderScene(canvas);};function test1(){d=new Date();time=d.getTime();startTime=d.getTime();console.log("fisrt enter");};function test2(picBase){d=new Date();var ds=d.getTime()-time;console.log("Base64 in"+ds);time=d.getTime();var showpic=picBase;if(img==null)img=document.createElement("img");showpic="data:image/jpeg;base64,"+showpic;var imgLoad=function(url){img.src=url;if(img.complete){init();}else{img.onload=function(){callback(img.width,img.height);img.onload=null;};};};imgLoad(showpic);console.log(d.time()-time);time=d.getTime();};function test4(){d=new Date();var ds=d.getTime()-time;console.log("flash recieve base64:"+ds);time=d.getTime();};function test5(){d=new Date();var ds1=d.getTime()-time;var ds2=d.getTime()-startTime;console.log("flash encode:"+ds1);console.log("total:"+ds2);};function loadSwf(){var version="1";var swfVersionStr="11.5.0";var xiSwfUrlStr="/v4/swf/playerProductInstall.swf";var flashvars={};0  flashvars.version=version;var params={};params.quality="high";params.bgcolor="#bababa";params.allowscriptaccess="always";params.allowfullscreen="true";params.allowFullScreenInteractive="true";params.wmode="opaque";var attributes={};attributes.id="HaoZhaoPian";attributes.name="HaoZhaoPian";attributes.align="middle";swfobject.embedSWF("../swf/TestReceiver.swf?v"+version,"flashContent","100%","100%",swfVersionStr,xiSwfUrlStr,flashvars,params,attributes);swfobject.createCSS("#flashContent","");}
